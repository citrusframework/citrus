<spring:beans
    xmlns="http://www.citrusframework.org/schema/testcase"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:spring="http://www.springframework.org/schema/beans"
    xmlns:http="http://www.citrusframework.org/schema/http/testcase"
    xmlns:petstore="http://www.citrusframework.org/citrus-test-schema/petstore-api"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.citrusframework.org/schema/testcase
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd
    http://www.citrusframework.org/schema/http/testcase
    http://www.citrusframework.org/schema/http/testcase/citrus-http-testcase.xsd
    http://www.citrusframework.org/citrus-test-schema/petstore-api
    http://www.citrusframework.org/citrus-test-schema/petstore-api/petstore-api.xsd"
>

    <template name="findPetTemplate">

        <create-variables>
            <variable name="petId" value="1234" />
        </create-variables>

        <petstore:send-find-pets-by-status status="${statusParameter}" fork="true"/>

        <http:receive-request server="httpServer">
            <http:GET path="/api/v3/pet/findByStatus">
                <http:param name="status" value="${statusParameter}"/>
            </http:GET>
        </http:receive-request>

        <http:send-response server="httpServer">
            <http:headers status="200">
                <http:header name="Content-Type" value="application/json" />
            </http:headers>
            <http:body type="json">
                <http:resource
                    file="classpath:org/citrusframework/openapi/generator/GeneratedApiTest/payloads/findPetsByStatus_response.json" />
            </http:body>
        </http:send-response>

        <petstore:receive-find-pets-by-status responseCode="200"/>
    </template>

    <testcase name="performFindPetFromTemplateTest">
        <actions>

            <call-template name="findPetTemplate">
                <parameter name="statusParameter" value="sold" />
            </call-template>

            <call-template name="findPetTemplate">
                <parameter name="statusParameter" value="pending" />
            </call-template>

        </actions>
    </testcase>
</spring:beans>
